---
id: 87d90002-f480-45eb-a8c4-d00df4d61557
title: Dendron-plugin
desc: ''
updated: 1607615583473
created: 1605375348464
parent: 32cdd4aa-d9f6-4582-8d0c-07f64a00299b
children: []
fname: dendron.pro.dendron-plugin
hpath: dendron.pro.dendron-plugin
---
# Lookup

```ts
show {
    quickpick := create
    provider := new LookupProvider
    @refreshButtons
    @updatePickerBehavior
    provider.provide quickpick
    quickpick.show
}
```

```ts
refreshButtons(buttons) {
    @state.buttonsPrev = quickpickButtons
    quickpick.buttons = buttons
}
```

```ts
updatePickerBehavior {
    @updateBehaviorByEffect

    if changedNoteType {
        @updateBehaviorByNoteType
    }

    if changedFilterType
        @provider.onUpdatePickerItem

    quickpick.oncreate :=
}
```

## Example

### Normal

- show
- updatePickerBehavior
  - source: updateBehaviorByNoteType(normal)

### Change Value

- updatePickerBehavior
  - source: onValueChange

## Ref

### Times when Picker is Updated

- onUpdatePickerItem
  - lc.show, on init
  - lc.updateBehaviorByNoteType, note type toggle
  - lc.updatePickerBehavior, direct filter toggle

### sources

#### UPDATE_PICKER_FILTER

- when direct filter has changed

#### updatePickerBehavior

- when changing note type
- values
  - normal
  - journal
  - scratch

## Lookup: onButton

- src/components/lookup/LookupControllerV2.ts

```ts
onTriggerButton {

}
```

# TreeView

## init

- onInitialize, reconstruct the whole tre

## refresh

- ReloadIndex
- SchemaWatcher
- FileWatcher

# Startup

- file: plugin-core/src/\_extension.ts

```ts
_activate {
    ws :=

    if ws.isActive {
        port = startServer
        updateEngineAPI(port)
        startLSPClient
        ws.reloadWorkspace
        ws.activateWatchers
    }

}
```

- reloadWorkspace

```ts
reloadWorkspace {
    ws.reloadWorkspace
    if isFirstInstall {
        showTutorial
    }
    postReloadWorkspace
    emit(extension, initialized)
}
```

- postReloadWorkspace

```ts
postReloadWorkspace {
    ws :=
    previousWsVersion = config.get(WORKSPACE_STATE.WS_VERSION)

    if previousWsVersion == 0.0.0 {
        execute(Upgrade)
        config.set(WORKSPACE_STATE.WS_VERSION, ws.version)
    } else {
        newVersion :=
        if (newVersion > previousWsVersion) {
            execute(Upgrade)
            config.set(WORKSPACE_STATE.WS_VERSION, ws.version)
            emit(extension, upgraded)
        }
    }
}

```

## Welcome Message

- file: plugin-core/src/\_extension.ts

```ts

showWelcomeOrWhatsNew {
    previousVersion := config.get(dendron.version)
    version :=

    // 1st install
    if !previousVersion {
        config.set(GLOBAL_STATE.VERSION, version)
        config.set(GLOBAL_STATE.VERSION_PREV, 0.0.0)
        return showWelcome()
    }

    // not 1st install
    if (version != previousVersion) {
        config.set(GLOBAL_STATE.VERSION, version)
        config.set(GLOBAL_STATE.VERSION_PREV, previousVersion)
        showInformationMessage(dendron has upgraded)

    }
}

```

## SetupWorkspace

- note: `dendron.code-workspace` is completely overwritten when running setup

# Vault Add

- src/commands/VaultAddCommand.ts 

```ts
execute:
    vaults = handleRemote

handleRemote:
    repoDir := 
    ensureDir(repoDir)
    git clone gitRepo
    vaults := repoDir
    vaults.map { addVaultToWorkspace }

addVaultToWorkspace vault: 
    createVault(vault)
    addToWorkspaceFile(vault)
```

